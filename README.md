# mini-meeting

# 文件介绍
文件夹"netapi"为网络封装包</br>
文件夹"服务端"为linux-qt的服务端包</br>
文件夹"demo"是windows-qt的客户端</br>


# 功能
1. 注册、登录（账号密码、微信、qq）
2. 大厅、房间系统
3. 采集视频、音频
4. 编码音频、解码音频、压缩视频
5. 发送音视频
6. 播放视频、播放声音
7. 优化---多线程...


# 开发进度

## 2023.3.29

客户端开发：

1. 将上一个项目（mini qq）的网络模块封装过来，在其基础上进行本项目的开发
2. 设计登录/注册界面，完成ckernel类（单例）的创建和基本功能（窗口初始化、回收）
3. 对两个窗口（登录、主）的操作放到ckernel类中实现
4. 连接网络端中接收数据和ckernel类中处理函数的信号和槽。
5. 协议映射表初始化


## 2023.3.30

服务器开发：

1. 连接虚拟机的服务端
1. 问题：客户端连接不上服务器，起初以为是虚拟机桥接和net连接的问题，修改后发现问题并没有解决，仔细观察代码后发现，是因为在demo窗口测试的时候连接过网络，那个部分的ip地址没有改...QAQ


## 2023.3.31

服务器开发：

1. 问题：网络连接不上，经多次调试，发现是宏替换出了问题？？直接字符串传ip地址就能连上了，但是用宏就连不上，不知道为什么
2. 服务器网络、线程池逻辑梳理





## 2023.4.1

服务器架构逻辑梳理

界面设计

1. 设置配置文件
2. 设计登陆注册界面



## 2023.4.3



1. 完成注册功能
2. 客户端发送注册请求
3. 服务端处理注册请求
4. 客户端处理注册回复





## 2023.4.4



1. 将MD5应用在密码
2. 完成登录功能
3. 客户端发送登录请求
4. 服务端处理登录请求（保存套接字的id的映射）
5. 客户端处理登陆回复
6. 主界面的设计




## 2023.4.5

1. 完善主界面设计

2. 完成主界面各控件的响应

3. 客户端发送创建房间、加入房间请求

4. 服务端处理创建房间请求

5. 问题：打包成.exe后无法在qt中运行了

   原因：之前没有写客户端打开网络失败的处理，导致在运行.exe文件时，在发送数据包时才会发现问题。所以写了个处理函数，但在构造函数里面写了return，返回后程序不会彻底关闭，导致在qt中运行的话会因为同时运行多个相同项目而打开失败。改成exit(0)后，问题解决。
   
   


## 2023.4.9



1. 完成房间界面设计
2. 服务端处理加入房间请求
3. 客户端处理加入房间回复
4. 客户端处理房间成员信息

## 2023.4.10



1. 客户端设置个人信息：弹出窗口，填写信息
2. 服务端处理用户信息
3. 服务端在修改信息和用户登录时给客户端发送用户信息
4. 客户端处理个人信息


## 2023.4.11



1. 声音的采集和编解码模块封装


## 2023.4.14



1. 视频的采集和播放模块封装

2. 问题：点击了开始按钮，不能跳转到槽函数。

   原因：在槽函数的声明处，没有写public slots，而是写了public。。。

   解决：权限出改为public slots:


## 2023.4.16



1. 退出房间的请求与回复处理
2. bug：创建房间时，之前创建多少次，就有多少个自己存在
3. bug2：另一个账号在加入房间时，无响应。。。
4. 解决：是因为加入房间时，要把自己的信息放到映射表中，我把这步操作放在处理加入房间回复中了，创建了一个新的user，释放不掉之前的。


## 2023.4.18



1. 客户端进行音视频获取和发送
2. 服务端处理和转发
3. 客户端对获取到的资源进行播放
4. bug1：退出房间时无响应，程序异常退出
5. bug2：可以一个账号登陆多个客户端，创建多个会议
6. bug3：视频在开启后几秒会产生异常

## 2023.4.19



1. 修复bug：

​	(1)bug1解决：是因为再退出房间是要删除map中的usershow数据，由于删除后没有给迭代器赋值，导致空指针异常。

​	(2)bug3解决：推测是因为发送的图像数据太大且图像数据是以对象形式传送的；尝试先压缩，再发送，发送引用。

2. 客户端点击设置大窗口
3. 桌面采集


## 2023.4.20



1. 人脸识别特效实现
2. 多线程优化





## 2023.4.21



1. 发送数据优化：多线程
2. 画面延迟优化：判断包时间和当前时间的大小，如果差距过大，就丢包
3. 音画问题优化（在同一个tcp连接上发送音频和视频数据，因为视频数据包过大，导致音频数据包由断层，音频卡顿）：创建三条tcp通路
4. bug:视频收发正常，音频发送出去后接收不到；解决：服务端转发除了问题（马虎）

5. 静音检测









# 一些问题



优化：

1. 相同账号登陆时强制退出
2. 退出时要回收用户信息，关闭三个套接字
3. 心跳：如果某用户不在会议中的时间过长，被强制下线（userinfo中加个上次通信时间）



1. 登录注册：登录建立用户id->socket映射

2. 房间系统：基于用户id转发

3. 音频视频：背景知识（视频：帧率、画质、每秒数据量、格式；音频：采样率、位宽、声道数、比特率、采集用的都是什么，什么格式，为什么用这个）

   **视频采集用opencv，因为后面想做人脸识别，为了扩展；还有其他的可以使用，比如说：...**

   **音频采集用的qt中的音频采集，其他的都比较麻烦，qt的简单易懂，也很稳定**

   **使用speex,jpeg压缩：**

   **静音检测使用webrtc**

4. 原理：如何同步？**与当前时间作比较，控制延迟在200ms以内，可以看成同步的（数据包里面包含了时间）**

5. 优化：多线程、多条tcp

6. 展望：当前服务器：epoll lt（epollin+epolloneshot）+阻塞模型

   优化：epoll lt非阻塞（one loop one thread）

   ​	one loop one thread：常见的开源libuv muduo网络库

   ​		一个线程里面有一个事件循环，监测的是多个套接字的epoll事件，他的发送和接收都会强制在这个线程内执行；可以避免多线程出现问题。

   学一学音频视频 编码解码 视频的x264 可以使用流媒体协议 rtmp rtsp

   固定房间--数据库表

   传文件

   libevent：网络开源库

   redis（最好掌握了）

